!function(){"use strict";function t(t,e){const n=e.querySelector(".fp-exp-tools__output");if(!n)return;const i=!1!==t.success,o=t.message||(i?"Operazione completata":"Operazione fallita");n.innerHTML=`\n            <div class="notice notice-${i?"success":"error"} is-dismissible" style="margin: 20px 0;">\n                <p><strong>${o}</strong></p>\n                ${t.details?`<pre style="background: #f5f5f5; padding: 10px; overflow-x: auto;">${JSON.stringify(t.details,null,2)}</pre>`:""}\n                ${void 0!==t.rebuilt?`<p>Esperienze aggiornate: ${t.rebuilt}</p>`:""}\n                ${void 0!==t.cleaned?`<p>Elementi puliti: ${t.cleaned}</p>`:""}\n            </div>\n        `,n.scrollIntoView({behavior:"smooth",block:"nearest"}),setTimeout(()=>{const t=n.querySelector(".notice-dismiss");t&&t.click()},1e4)}function e(t,e){t.trim()?e.textContent=t:e.textContent=window.fpExpAdmin.getString("No subject")}window.fpExpAdmin=window.fpExpAdmin||{},window.fpExpAdmin.initTools=function(){!function(){const t=document.querySelectorAll("[data-fp-email-subject-preview]");if(!t.length)return;t.forEach(t=>{const n=t.querySelector('input[type="text"]'),i=t.querySelector("[data-fp-email-preview]");n&&i&&(n.addEventListener("input",function(){e(this.value,i)}),e(n.value,i))})}(),function(){const t=document.querySelectorAll("[data-fp-cognitive-bias-limiter]");if(!t.length)return;t.forEach(t=>{const e=t.querySelector("input, textarea"),n=t.querySelector("[data-fp-cognitive-bias-counter]"),i=parseInt(t.getAttribute("data-fp-cognitive-bias-max"))||100;if(!e||!n)return;e.addEventListener("input",function(){const t=this.value.length,o=i-t;n.textContent=`${t}/${i}`,o<0?(n.classList.add("is-over-limit"),e.classList.add("is-over-limit")):(n.classList.remove("is-over-limit"),e.classList.remove("is-over-limit"))});const o=e.value.length;n.textContent=`${o}/${i}`})}(),function(){const e=document.querySelector("[data-fp-exp-tools]");if(!e)return;const n=e.querySelectorAll("button[data-action]");if(!n.length)return;n.forEach(n=>{n.addEventListener("click",async function(n){n.preventDefault();const i=this.getAttribute("data-action");if(!i)return;this.disabled=!0;const o=this.textContent;this.textContent="Esecuzione...";try{const n=window.fpExpTools?.nonce||window.fpExpAdmin?.restNonce||"",o=await fetch(`/wp-json/fp-exp/v1/tools/${i}`,{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":n},credentials:"same-origin"});t(await o.json(),e)}catch(n){t({success:!1,message:n.message||"Errore durante l'esecuzione del tool"},e)}finally{this.disabled=!1,this.textContent=o}})})}()}}();