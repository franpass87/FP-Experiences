!function(){"use strict";window.FPFront||(window.FPFront={});var t={widget:null,slotsEl:null,config:{},rtbForm:null,startInput:null,endInput:null,ticketsHidden:null,addonsHidden:null,summaryEl:null,ctaBtn:null};function e(t,e){try{return new Intl.NumberFormat(void 0,{style:"currency",currency:e||"EUR"}).format(Number(t||0))}catch(e){return String(t||0)}}function n(){var t={};return document.querySelectorAll(".fp-exp-party-table tbody tr[data-ticket]").forEach(function(e){var n=e.getAttribute("data-ticket")||"",r=e.querySelector(".fp-exp-quantity__input");if(n&&r){var a=parseInt(r.value,10)||0;a>0&&(t[n]=a)}}),t}window.FPFront.summaryRtb={init:function(r){t=Object.assign(t,r||{});var a=document.querySelector(".fp-exp-summary");if(a){t.summaryEl=a,t.rtbForm=document.querySelector("form.fp-exp-rtb-form"),t.startInput=t.rtbForm?t.rtbForm.querySelector('input[name="start"]'):null,t.endInput=t.rtbForm?t.rtbForm.querySelector('input[name="end"]'):null,t.ticketsHidden=t.rtbForm?t.rtbForm.querySelector('input[name="tickets"]'):null,t.addonsHidden=t.rtbForm?t.rtbForm.querySelector('input[name="addons"]'):null,t.ctaBtn=document.querySelector(".fp-exp-summary__cta");var i,o=a.querySelector("[data-fp-summary-status]"),u=a.querySelector("[data-fp-summary-body]"),d=a.querySelector("[data-fp-summary-lines]"),l=a.querySelector("[data-fp-summary-adjustments]"),s=a.querySelector("[data-fp-summary-total-row]"),c=a.querySelector("[data-fp-summary-total]"),p=a.querySelector(".fp-exp-summary__disclaimer"),m=a.getAttribute("data-loading-label")||"Aggiornamento prezzo…",f=a.getAttribute("data-error-label")||"Impossibile aggiornare il prezzo. Riprova.",y=a.getAttribute("data-empty-label")||"Seleziona i biglietti per vedere il riepilogo",g=null,b=t.config&&t.config.experienceId||0,x=((i=window.fpExpApiBase&&"string"==typeof window.fpExpApiBase?window.fpExpApiBase:window.wpApiSettings&&wpApiSettings.root||location.origin+"/wp-json/").endsWith("/")?i:i+"/")+"fp-exp/v1/rtb/quote";t.widget.addEventListener("change",function(t){t.target&&t.target.closest(".fp-exp-quantity__input")&&(S(),v()),t.target&&t.target.matches('.fp-exp-addons input[type="checkbox"]')&&S()}),t.widget.addEventListener("input",function(t){t.target&&t.target.closest(".fp-exp-quantity__input")&&(S(),v())}),t.slotsEl&&t.slotsEl.addEventListener("click",function(t){t.target&&t.target.closest(".fp-exp-slots__item")&&(S(),v())}),v()}function h(t){if(o){o.hidden=!1;var e=o.querySelector(".fp-exp-summary__message");e&&(e.textContent=t||y)}u&&(u.hidden=!0)}function v(){if(t.ctaBtn){var e=n(),r=e&&Object.keys(e).length>0,a=t.startInput&&t.endInput?Boolean((t.startInput.value||"").trim()&&(t.endInput.value||"").trim()):!(!t.slotsEl||!t.slotsEl.querySelector(".fp-exp-slots__item.is-selected"));t.ctaBtn.disabled=!(r&&a)}}function _(){if(!b)return h(y),void v();var r,i=n(),g=(r={},document.querySelectorAll(".fp-exp-addons li[data-addon]").forEach(function(t){var e=t.getAttribute("data-addon")||"",n=t.querySelector('input[type="checkbox"]');e&&n&&n.checked&&(r[e]=1)}),r);if(t.ticketsHidden&&(t.ticketsHidden.value=JSON.stringify(i)),t.addonsHidden&&(t.addonsHidden.value=JSON.stringify(g)),!i||0===Object.keys(i).length)return h(y),void v();h(m);var _={nonce:t.config&&(t.config.rtbNonce||t.config.nonce)||(t.rtbForm?t.rtbForm.getAttribute("data-nonce"):""),experience_id:b,slot_id:0,start:t.startInput?t.startInput.value:"",end:t.endInput?t.endInput.value:"",tickets:i,addons:g},S={"Content-Type":"application/json"};"undefined"!=typeof fpExpConfig&&fpExpConfig.restNonce&&(S["X-WP-Nonce"]=fpExpConfig.restNonce),fetch(x,{method:"POST",credentials:"same-origin",headers:S,body:JSON.stringify(_)}).then(function(t){if(!t.ok)throw new Error("HTTP "+t.status+": "+t.statusText);return t.json()}).then(function(t){if(t&&!0===t.success&&t.breakdown){var n=t.breakdown;if(d){d.innerHTML="";var r=function(t){var r=document.createElement("li");r.className="fp-exp-summary__line";var a=document.createElement("span");a.className="fp-exp-summary__line-label",a.textContent=String(t.label||"")+" × "+String(t.quantity||0);var i=document.createElement("span");return i.className="fp-exp-summary__line-amount",i.textContent=e(t.line_total,n.currency),r.appendChild(a),r.appendChild(i),r};(Array.isArray(n.tickets)?n.tickets:[]).forEach(function(t){d.appendChild(r(t))}),(Array.isArray(n.addons)?n.addons:[]).forEach(function(t){d.appendChild(r(t))})}if(l){var i=Array.isArray(n.adjustments)?n.adjustments:[];0===i.length?(l.hidden=!0,l.innerHTML=""):(l.hidden=!1,l.innerHTML="",i.forEach(function(t){var r=document.createElement("li");r.className="fp-exp-summary__adjustment";var a=document.createElement("span");a.className="fp-exp-summary__adjustment-label",a.textContent=t.label||"";var i=document.createElement("span");i.className="fp-exp-summary__adjustment-amount",i.textContent=e(t.amount,n.currency),r.appendChild(a),r.appendChild(i),l.appendChild(r)}))}if(c&&(c.textContent=e(n.total,n.currency)),s&&(s.hidden=!1),p){var m=a.getAttribute("data-tax-label")||"";m&&(p.textContent=m,p.hidden=!1)}o&&(o.hidden=!0),u&&(u.hidden=!1),v()}else h(f)}).catch(function(t){h(f),v()})}function S(){g&&clearTimeout(g),g=setTimeout(_,300)}}}}();